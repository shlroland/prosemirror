# delpoy:
#   provider: pages
#   skip_cleanup: true
#   github_token: $GITHUB_TOKEN
#   on:
#     branch: master
#   github_url: prosemirror.xheldon.com
language: node_js
node_js:
  - "14.8.0"
install:
  - "npm i yarn -g"
  - "bin/pm install"
before_script:
  - "cd website"
  - "yarn"
script:
  - "make"
env:
    - NODE_ENV=prod
after_success:
    - cd public
    - echo "prosemirror.xheldon.com" > CNAME
    - echo -e "# [ProseMirror Chinese doc](https://prosemirror.xheldon.com) \n\nGenerated by [https://github.com/xheldon-prosemirror/prosemirror](https://github.com/xheldon-prosemirror/prosemirror) " > README.md
    - git init
    - git checkout -b master
    - git add -A
    - git -c user.name='travis' -c user.email='travis' commit -m 'update docs'
    - git push -f -q https://Xheldon:$GITHUB_TOKEN@github.com/Xheldon/prosemirror-doc-cn master
